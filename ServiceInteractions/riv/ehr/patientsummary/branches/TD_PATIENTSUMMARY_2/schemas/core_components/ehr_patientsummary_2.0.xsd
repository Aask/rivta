<?xml version="1.0" encoding="UTF-8"?>
<!-- 
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements. See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership. Sveriges Kommuner och Landsting licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License. You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied. See the License for the
 specific language governing permissions and limitations
 under the License.
 -->
<xs:schema 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    xmlns:tns="urn:riv:ehr:patientsummary:2" 
    targetNamespace="urn:riv:ehr:patientsummary:2" 
    elementFormDefault="qualified" 
    attributeFormDefault="unqualified" 
    version="2.0">
	
    <xs:import schemaLocation="datatypes.xsd"/>

	<xs:complexType name="AssignedEntityType">
		<xs:annotation>
			<xs:documentation>
				Information om person som signerat dokument
			
				assignedEntityID: 
					HSA-id för person
				representedOrganizationID: 
					HSA-id för den organisation som personen har uppdrag för
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="AssignedEntityID" type="tns:HSAIdType"/>
			<xs:any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>
		
	<xs:complexType name="AuthorizationType">
		<xs:annotation>
			<xs:documentation>
				Information om menprövning
			
				authorizationCode: 
					Kod som anger typ av tillgänglighet. Tillåtna värden
					är P0-00790 för Information till Patient (att information
					är tillgänglig till patient kan ha föregåtts av menprövning)
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="authorizationCode" type="ST" fixed=" P0-00790 för Information till Patient"/>
			<xs:any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>

	<xs:complexType name="AuthorType">
		<xs:annotation>
			<xs:documentation>
				Information om författare till dokumentet
			
				authorTime: 
					Tidpunkt då dokumentet skapades
				authorID: 
					HSA-id för författare. 
					OID för HSA används (1.2.752.129.2.2.1.4)
				authorRoleCode: 
					Kod för författarens befattning, enligt kodverket Befattning (OID 1.2.752.129.2.2.1.4)
				authorName: 
					Namn på författaren
				authorOrganizationID: 
					HSA-id för den enhet som författaren är uppdragstagare hos
				authorOrganizationName: 
					Namn på den enhet som författaren är uppdragstagare hos
				authorOrganizationTelecom: 
					Telefonnummer till den enhet som författaren är uppdragstage hos
				authorOrganizationAddress: 
					Adress till den enhet som författaren är uppdragstagere hos
				careProviderId:
					HSA-id för vårdgivaren, som är vårdgivare för den enhet som författaren är uppdragstagare för
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="authorTime" type="tns:TimestampType"/>
			<xs:element name="authorID">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="II">
							<xs:attribute name="root" use="required" fixed="1.2.752.129.2.2.1.4">
								<xs:simpleType>
									<xs:restriction base="uid"/>
								</xs:simpleType>
							</xs:attribute>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
			<xs:element name="authorRoleCode" minOccurs="0">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="II">
							<xs:attribute name="root" use="required" fixed="1.2.752.129.2.2.1.4">
								<xs:simpleType>
									<xs:restriction base="uid"/>
								</xs:simpleType>
							</xs:attribute>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
			<xs:element name="authorName" type="ST" minOccurs="0"/>
			<xs:element name="authorOrganizationID" type="tns:HSAIdType"/>
			<xs:element name="authorOrganizationName" type="ST" minOccurs="0"/>
			<xs:element name="authorOrganizationTelecom" type="ST" minOccurs="0"/>
			<xs:element name="authorOrganizationAddress" type="ST" minOccurs="0"/>
			<xs:element name="careProviderID" type="tns:HSAIdType"/>
			<xs:any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>
    
	<xs:complexType name="CustodianType">
		<xs:annotation>
			<xs:documentation>
				Information om PDL-enhet som har ansvar för informationen
			
				custodianID: 
					HSA-id för PDL-enhet
				legalAuthenticator:
					Information om signering				
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="custodianID" type="tns:HSAIdType"/>
			<xs:element name="legalAuthenticator" type="tns:LegalAuthenticatorType" minOccurs="0"/>
			<xs:any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>

	<xs:complexType name="LegalAuthenticatorType">
		<xs:annotation>
			<xs:documentation>
				Information om signering
			
				signatureTime: 
					Tidpunkt för signering, format ÅÅÅÅMMDDttmmss. 
					RIV: Vård- och omsorgsdokument.signeringstidpunkt
				assignedEntity:
					Information om person som signerat dokumentet
				representedOrganizationID
					HSA-id för den organisation som personen har uppdrag för
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="signatureTime" type="tns:TimestampType"/>
			<xs:element name="assignedEntity" type="tns:AssignedEntityType" minOccurs="0"/>
			<xs:element name="representedOrganizationID" type="tns:HSAIdType"/>
			<xs:any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>
        
	<xs:complexType name="PatientSummaryHeaderType">
		<xs:annotation>
			<xs:documentation>
				documentID: 
					Vårddokumentets unika identifierare.
					OID kan sättas till 1.2.752.129.2.1.2.1 
					(Icke-nationell identifierare Org+lokalt unikt id)
				documentCode:
					Kod som anger typ av innehåll
				documentTitle: 
					Titel på dokumentet/anteckningen
				documentTime: 
					Relevant tid, definieras för varje meddelande
				patientID: 
					Patientens ID. Root sätts till typ av patientidentifierare
					Bland tillåtna typer för finns: 
						personnummer (1.2.752.129.2.1.3.1), 
						samordningsnummer (1.2.752.129.2.1.3.3), 
						reservnummer SLL (1.2.752.97.3.1.3)
				author
					Information om författare till dokumentet
				custodian
					Information om PDL-enhet som har ansvar för informationen
				authorization
					Information om tillgänglighet av information, exempelvis att information kan ges till patient
				encompassingEncounter
				    Information om  Vård- och omsorgskontakt som föranlett vårddokumentation
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="documentID">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="II">
							<xs:attribute name="root" type="uid" use="required" fixed="1.2.752.129.2.1.2.1"/>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
			<xs:element name="documentCode" type="CD"/>
			<xs:element name="documentTitle" type="ST" minOccurs="0"/>
			<xs:element name="documentTime" type="tns:TimestampType"/>
			<xs:element name="patientID">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="II">
							<xs:attribute name="root" type="uid" use="required"/>
							<xs:attribute name="extension" use="required">
								<xs:simpleType>
									<xs:restriction base="st">
										<xs:enumeration value="1.2.752.129.2.1.3.1"/>
										<xs:enumeration value="1.2.752.129.2.1.3.3"/>
										<xs:enumeration value="1.2.752.97.3.1.3"/>
									</xs:restriction>
								</xs:simpleType>
							</xs:attribute>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
			<xs:element name="author" type="tns:AuthorType"/>
			<xs:element name="custodian" type="tns:CustodianType"/>
			<xs:element name="authorization" type="tns:AuthorizationType" minOccurs="0" maxOccurs="unbounded"/>
		</xs:sequence>
	</xs:complexType>

    <xs:complexType name="PatientSummaryRequestType">
        <xs:annotation>
            <xs:documentation>
                authorOrganizationID: 
                    HSA-Id för e-tjänsteproducent.
                patientID: 
                    Patientens identitet, nationellt unikt person-id.
                timePeriod:
                    Begränsning av sökningen i tid, baserat på kliniskt
                    relevanta datum. Händelser anses ligga inom intervallet, 
                    om de till någon del ligger inom intervallet. 
                    (Start- och slutpunkt inkluderas i intervallet.) 
                    Formatet för start- respektive slutdatum är ÅÅÅÅMMDD.
            </xs:documentation>
        </xs:annotation>	
        <xs:sequence>
            <xs:element name="authorOrganizationID" type="tns:HSAIdType"/>
            <xs:element name="patientID">
                <xs:complexType>
                    <xs:complexContent>
                        <xs:restriction base="II">
                            <xs:attribute name="root" type="uid" use="required"/>
                            <xs:attribute name="extension" type="st" use="required"/>
                        </xs:restriction>
                    </xs:complexContent>
                </xs:complexType>
            </xs:element>
            <xs:element name="timePeriod" type="tns:TimePeriodType" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
    
	<!-- 
		Below: types that 
			(1) extends another type and 
			(2) adds some kind of restriction to the type 
	 -->
	<xs:complexType name="HSAIdType">
		<xs:complexContent>
			<xs:restriction base="II">
				<xs:attribute name="nullFalvor" use="prohibited"/>
				<xs:attribute name="root" use="required" fixed="1.2.752.129.2.1.4.1">
					<xs:simpleType>
						<xs:restriction base="uid"/>
					</xs:simpleType>
				</xs:attribute>
				<xs:attribute name="extension" type="st" use="required"/>
			</xs:restriction>
		</xs:complexContent>
	</xs:complexType>
	
	<xs:complexType name="TimestampType">
		<xs:annotation>
			<xs:documentation>
				Patient Summary Timestamp type
				
				Den komplexa typen sätter restriktioner på bastypen TS genom att kräva att
				attributet value existerar och att värdet är enligt specificerat mönster.

				value: 
					Tidpunkt på formatet ÅÅÅÅMMDDttmmss
			</xs:documentation>
		</xs:annotation>
		<xs:complexContent>
			<xs:restriction base="TS">
				<xs:attribute name="value" use="required">
					<xs:simpleType>
						<xs:restriction base="ts">
							<xs:pattern value="(19|20)\d\d(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])\d{6}"/>
						</xs:restriction>
					</xs:simpleType>
				</xs:attribute>
			</xs:restriction>
		</xs:complexContent>
	</xs:complexType>
	
	<xs:complexType name="TimePeriodType">
		<xs:annotation>
			<xs:documentation>
				Patient Summary Time Period type
				
				Den komplexa typen används för att sätta ett
				datumintervall med hjälp av start- och slutdatum

				start: 
					Startdatum på formatet ÅÅÅÅMMDD
				end: 
					Slutdatum på formatet ÅÅÅÅMMDD
			</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="start">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="TS">
							<xs:attribute name="value" use="required">
								<xs:simpleType>
									<xs:restriction base="ts">
										<xs:pattern value="(19|20)\d\d(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])"/>
									</xs:restriction>
								</xs:simpleType>
							</xs:attribute>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
			<xs:element name="end">
				<xs:complexType>
					<xs:complexContent>
						<xs:restriction base="TS">
							<xs:attribute name="value" use="required">
								<xs:simpleType>
									<xs:restriction base="ts">
										<xs:pattern value="(19|20)\d\d(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])"/>
									</xs:restriction>
								</xs:simpleType>
							</xs:attribute>
						</xs:restriction>
					</xs:complexContent>
				</xs:complexType>
			</xs:element>
		</xs:sequence>
	</xs:complexType>	
</xs:schema>
